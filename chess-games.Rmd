---
title: "Chess games analysis"
output: html_notebook
---

# About the dataset

The chosen dataset concerns over 20 000 games taken from the popular online chess website Lichess.org. It contains both qualitative and quantitative data and lends itself to many forms of analysis and study.

The following variables are of use to me:

- Turns: the number of turns (double the number of moves) it took for the game to end, a quantitative variable (continuous integers)
- Victory status: the type of event that concluded the match, a qualitative variable
- Winner: the colour of the winning party, a qualitative variable
- Increment code: type of game-time incrementation used, a qualitative variable
- White/Black rating: Lichess (Glicko-2) rating based on user's ranked game history, a quantitative variable (continuous integers)
- Opening eco: the chess opening code for a given opening, a qualitative variable
- Opening ply: the number of moves in the opening phase, a quantitative variable (continuous integers)

There are a few more variables that I have chosen to ignore, for the following reasons:

- Review number : index of a review which does not provide relevant information for our statistical analysis
- Variety : string containing a description of the type (contents) of ramen, which requires additional processing such as keyword extraction to be practical in our analysis
- Top ten : the year a certain ramen made it to the top ten, along with its position in the ranking

## Initial analysis - data visualisation

To make the data-set more approachable, I conducted some visualisations to better understand the type and layout of the data I am working with. For this however, I first needed to convert the ratings into numbers (float types), as by default they are of string type. Then I proceeded to remove rows with a missing rating to prevent erroneous data in future manipulations/calculations.

```{r include=FALSE}
library(ggplot2)
library(ggcorrplot)
library(tidyverse)
library(tidyr)
library(dplyr)
library(formattable)
games <- read.csv("games.csv")
```

### Visualising the number of turns

```{r}
ggplot(games, aes(x=turns)) + geom_histogram(binwidth=15, fill="#ff6361", color="black") + ggtitle("Game turns count")
```
### Visualising the ratings

As the most optimal opponent range has a rating of +/- 100 to 150, I have chosen a bin size of 100 for the ratings histogram. 

```{r}
ggplot(games, aes(x=white_rating)) + geom_histogram(binwidth=100, fill="skyblue1", color="black") + ggtitle("White rating") + xlab("Ratings") + ylab("Number of players")
ggplot(games, aes(x=black_rating)) + geom_histogram(binwidth=100, fill="indianred1", color="black") + ggtitle("Black rating") + xlab("Ratings") + ylab("Number of players")
```

When a user first registers on Lichess, their rating starts at 1500 (+/- 700). The 1500 represents their rating and the 700 represents the confidence interval. This is because an average club player is rated 1500, which is around the 50th percentile for every variant and time control in chess.

It is thus unsurprising that both white and black ratings peak at around 1500. The ratings seem to be slightly right-skewed, which also makes sense, as usually the higher rated a player is, the more invested they are in the game. This in turns means that they play more and are thus more likely to be playing ranked games on Lichess.

#### Comparing the ratings

```{r}
ggplot(games) + geom_histogram(aes(x=white_rating), binwidth=100, fill="skyblue1", color="black", alpha=0.6) + geom_histogram(aes(x=black_rating), binwidth=100, fill="indianred1", color="black", alpha=0.6) + ggtitle("Comparing ratings") + xlab("Ratings") + ylab("Number of players")
```

We can see that the ratings for both white and black are mostly overlapping. This does not come as a surprise as a player should be able to play both as white and as black, and therefore would have comparable ratings for both of those colours. Interestingly enough, it would seem that there are slightly higher ratings for white, as the level of game increases, while black ratings seem to have a minimal edge for lower ranked players. 

## Quantitative overview

We can now more closely examine our quantitative variables: the amount of turns, white/black ratings, and the amount of moves in the opening phase of a game.

Helper functions:

```{r}
mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}

trimean <- function(x) {
  quartiles <- quantile(x, prob=c(.25,.5,.75))
  q1 <- quartiles[1]
  q2 <- quartiles[2]
  q3 <- quartiles[3]
  (q1 + 2 * q2 + q3) / 4
}

gm_mean = function(x) {
  exp(sum(log(x[x > 0])) / length(x))
}

rel_range = function(x) {
  max(x) - min(x)
}

iqr = function(x) {
  quartiles <- quantile(x, prob=c(.25,.5,.75))
  quartiles[3] - quartiles[1]
}
```

### Number of turns

```{r warning=FALSE}
turns_overview <- games %>% summarise(Mean = mean(turns), Median = median(turns), Mode = mode(turns), Trimean = trimean(turns), "Geometric mean" = gm_mean(turns), "20% Trimmed mean" = mean(turns, trim=.2), Range = rel_range(turns), IQR = iqr(turns), Variance = var(turns), "Standard deviation" = sd(turns))
turns_overview <- turns_overview %>% gather("Measure", "Value")
formattable(turns_overview)
```

### White rating

```{r warning=FALSE}
w_rating_overview <- games %>% summarise(Mean = mean(white_rating), Median = median(white_rating), Mode = mode(white_rating), Trimean = trimean(white_rating), "Geometric mean" = gm_mean(white_rating), "20% Trimmed mean" = mean(white_rating, trim=.2), Range = rel_range(white_rating), IQR = iqr(white_rating), Variance = var(white_rating), "Standard deviation" = sd(white_rating))
w_rating_overview <- w_rating_overview %>% gather("Measure", "Value")
formattable(w_rating_overview)
```

### Black rating

```{r warning=FALSE}
b_rating_overview <- games %>% summarise(Mean = mean(black_rating), Median = median(black_rating), Mode = mode(black_rating), Trimean = trimean(black_rating), "Geometric mean" = gm_mean(black_rating), "20% Trimmed mean" = mean(black_rating, trim=.2), Range = rel_range(black_rating), IQR = iqr(black_rating), Variance = var(black_rating), "Standard deviation" = sd(black_rating))
b_rating_overview <- b_rating_overview %>% gather("Measure", "Value")
formattable(b_rating_overview)
```

### Moves in opening phase

```{r warning=FALSE}
ply_overview <- games %>% summarise(Mean = mean(opening_ply), Median = median(opening_ply), Mode = mode(opening_ply), Trimean = trimean(opening_ply), "Geometric mean" = gm_mean(opening_ply), "20% Trimmed mean" = mean(opening_ply, trim=.2), Range = rel_range(opening_ply), IQR = iqr(opening_ply), Variance = var(opening_ply), "Standard deviation" = sd(opening_ply))
ply_overview <- ply_overview %>% gather("Measure", "Value")
formattable(ply_overview)
```

## Examining relationships

### Correlation matrices

```{r}
char2num<-function(x) { 
  groups = unique(x) 
  as.numeric(factor(x, levels=groups)) 
}

matrix_data <- subset(games, select = c(turns, white_rating, black_rating, opening_eco, winner, victory_status, increment_code, opening_ply, white_id, black_id))
matrix_data$opening_eco <- char2num(matrix_data$opening_eco)
matrix_data$winner <- char2num(matrix_data$winner)
matrix_data$victory_status <- char2num(matrix_data$victory_status)
matrix_data$increment_code <- char2num(matrix_data$increment_code)
matrix_data$white_id <- char2num(matrix_data$white_id)
matrix_data$black_id <- char2num(matrix_data$black_id)
corr <- cor(matrix_data)
ggcorrplot(corr, lab = TRUE)
```